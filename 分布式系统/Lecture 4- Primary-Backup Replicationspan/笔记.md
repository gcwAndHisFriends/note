# VMware FT

失败停止:

复制系统没有覆盖:bug(mapreduce中的错误),硬件设计缺陷

可以将硬件故障转化为软件失败停止，比如网络传输出错，或磁盘出错(通过校验码)，然后通过软件进行重新处理

论文中给出的两种复制方法

state transfer 状态转移

将整个系统都拷贝过去，备份可以用它得到的最后一个状态开始执行



replicated state maching  (复制状态机)

发送修改的部分，只是发送外部到来的事件

不过涉及到一些事件随机化的函数时可能会出错

复制状态机很难用于多核并行的情况



Vmware FT 会在备用机中伪造一个网络数据包，发给应用程序的副本

主机会生成一个应答包，虚拟机监视器(VMM)会把数据发给client，而会把备份机的应答包丢弃

当primary崩溃时，会停止发送日志。当备份没有收到日志时，就意识到出错，就让backup上线，vmm允许备份自由执行而不需primary的输入事件，同时将client的请求发给备用，也不会再丢弃数据包

如果primary在完成修改，返回数据之后。与副本的网络断开并宕机。

解决方法:输出规则

确认直到备份已经收到所有log_record时，才允许primary对外发送输出

primary必须停下来等待备份，这是性能瓶颈，可以只在写一类的操作时再停下来等待

在备机上线时，必须要首先处理未处理掉的log

