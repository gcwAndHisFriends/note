# 应用层

应用层只需要专注于为用户提供应用功能，比如 HTTP、FTP、Telnet、DNS、SMTP等。

应用层是不用去关心数据是如何传输的，就类似于，我们寄快递的时候，只需要把包裹交给快递员，由他负责运输快递，我们不需要关心快递是如何被运输的。

# 传输层

## TCP

流量控制、超时重传、拥塞控制

当传输层的数据包大小超过 MSS（TCP 最大报文段长度） ，就要将数据包分块.每个分块称为一个 **TCP 段**

# 网络层

## IP 协议

如果 IP 报文大小超过 MTU（以太网中一般为 1500 字节）就会**再次进行分片**

将 IP 地址分成两种意义：

- 一个是**网络号**，负责标识该 IP 地址是属于哪个「子网」的；
- 一个是**主机号**，负责标识同一「子网」下的不同主机；

需要配合**子网掩码**才能算出 IP 地址 的网络号和主机号。

#  网络接口层

在以太网进行通讯要用到 MAC 地址,通过 ARP 协议获取对方的 MAC 地址。

# 真实地址查询 —— DNS

- 根 DNS 服务器（.）
- 顶级域 DNS 服务器（.com）
- 权威 DNS 服务器（server.com）

DNS 域名解析的过程**只指路不带路**。

# TCP

**源端口号**(16)和**目标端口**(16)号，即自己的端口号和对方的端口号

包的**序**号(32),为了解决包乱序的问题。

**确认号**（32）目的是确认发出去对方是否有收到。

**状态位**，`SYN` 是发起一个连接，`ACK` 是回复，`RST` 是重新连接，`FIN` 是结束连接等这些带状态位的包的发送，会引起双方的状态变更。

**窗口大小**(16)，TCP 要做**流量控制**，通信双方各声明一个窗口（缓存大小），标识自己当前能够的处理能力。**拥塞控制**，控制自己，也即控制发送的速度

# 三次握手

# IP:远程定位

在 IP 协议里面需要有**源地址 IP** 和 **目标地址 IP**：

- 源地址IP，即是客户端输出的 IP 地址；
- 目标地址，即通过 DNS 域名解析得到的 Web 服务器 IP。



# MAC:两点传输

生成了 IP 头部之后，接下来网络包还需要在 IP 头部的前面加上 **MAC 头部**。

MAC 头部是以太网使用的头部，它包含了接收方和发送方的 MAC 地址等信息。

一般在 TCP/IP 通信里，MAC 包头的**协议类型**只使用：

- `0800` ： IP 协议
- `0806` ： ARP 协议

**发送方**的 MAC 地址获取就比较简单了，MAC 地址是在网卡生产时写入到 ROM 里的，只要将这个值读取出来写入到 MAC 头部就可以了。

**接收方**的 MAC 地址就有点复杂了，只要告诉以太网对方的 MAC 的地址，以太网就会帮我们把包发送过去，那么很显然这里应该填写对方的 MAC 地址。

ARP 协议会在以太网中以**广播**的形式，如果对方和自己处于同一个子网中，那么通过上面的操作就可以得到对方的 MAC 地址

后续操作系统会把本次查询结果放到一块叫做 **ARP 缓存**

